#N canvas 345 122 920 782 12;
#X obj 277 463 line;
#X obj 370 495 b;
#X obj 277 327 t b f, f 8;
#X obj 302 388 r grain_\$0;
#X obj 277 360 var target_\$0 ms_\$0;
#X obj 370 559 expr if(d_\$0 > 0 && $f1 > target_\$0 \, target_\$0 \, $f1);
#X obj 370 586 expr if(d_\$0 < 0 && $f1 < target_\$0 \, target_\$0 \, $f1);
#X obj 558 457 v inc_\$0;
#X obj 501 457 v b_\$0;
#X obj 445 457 v a_\$0;
#X obj 370 527 expr a_\$0 - (b_\$0 = b_\$0 * inc_\$0);
#X obj 360 624 v current_\$0;
#X obj 370 710 outlet;
#X obj 96 46 inlet;
#N canvas 814 194 575 545 init 0;
#X obj 153 69 else/loadbanger 2, f 24;
#X msg 412 139 5;
#X msg 378 139 0;
#X msg 449 139 1;
#X obj 72 189 list split 1;
#X obj 72 230 else/swap2;
#X obj 166 189 list split 1;
#X obj 166 230 else/swap2;
#X obj 153 106 else/args -;
#X obj 412 355 s grain_\$0;
#X obj 449 263 * -4;
#X obj 181 349 v curve_\$0;
#X obj 181 321 v grain_\$0;
#X obj 449 293 s curve_\$0;
#X obj 154 438 v n_\$0;
#X obj 155 397 expr ms_\$0/grain_\$0;
#X obj 88 107 t b b;
#X obj 412 325 max 5;
#X obj 153 139 route -rate -curve float list;
#X obj 299 169 unpack;
#X obj 322 394 v msup_\$0;
#X obj 408 402 v msdown_\$0;
#X connect 0 0 16 0;
#X connect 0 1 1 0;
#X connect 0 1 2 0;
#X connect 0 1 3 0;
#X connect 1 0 17 0;
#X connect 2 0 20 0;
#X connect 2 0 21 0;
#X connect 3 0 10 0;
#X connect 4 0 5 0;
#X connect 4 1 5 1;
#X connect 5 0 18 0;
#X connect 5 1 17 0;
#X connect 6 0 7 0;
#X connect 6 1 7 1;
#X connect 7 0 18 0;
#X connect 7 1 10 0;
#X connect 8 0 18 0;
#X connect 10 0 13 0;
#X connect 15 0 14 0;
#X connect 16 0 15 0;
#X connect 16 1 8 0;
#X connect 17 0 9 0;
#X connect 18 0 4 0;
#X connect 18 1 6 0;
#X connect 18 2 20 0;
#X connect 18 3 19 0;
#X connect 19 0 20 0;
#X connect 19 1 21 0;
#X restore 597 174 pd init;
#X obj 351 468 > 0.001;
#X obj 277 495 else/router;
#X obj 399 46 inlet;
#X obj 96 90 route rate reset float list curve;
#X obj 299 122 * -4;
#X obj 299 152 s curve_\$0;
#X obj 155 345 v n_\$0;
#X obj 155 304 expr ms_\$0 / (grain_\$0 = $f1), f 16;
#X obj 155 274 max 5;
#X obj 136 391 v target_\$0;
#X msg 217 431 set \$1;
#X obj 743 457 v target_\$0;
#X obj 684 457 v d_\$0;
#X obj 445 337 expr current_\$0 + b_\$0 \; (target_\$0 - current_\$0) / (1 - exp(curve_\$0)) \; exp(curve_\$0 / n_\$0) \; ms_\$0/grain_\$0 \; if(d_\$0 > 0 \, ms_\$0 = msup_\$0 \, ms_\$0 = msdown_\$0) \; target_\$0 - current_\$0 \; $f1;
#X obj 628 457 v n_\$0;
#X obj 399 229 v msup_\$0;
#X obj 272 181 unpack f f f;
#X obj 489 46 inlet;
#X obj 489 229 v msdown_\$0;
#X text 592 104 Part of ELSE \; https://github.com/porres/pd-else;
#X text 594 85 Alexandre Torres Porres (2025);
#X obj 371 300 else/router;
#X obj 479 259 r curve_\$0;
#X obj 479 306 > 0.001;
#X obj 479 283 abs;
#X obj 351 417 r curve_\$0;
#X obj 351 441 abs;
#X connect 0 0 16 0;
#X connect 1 0 10 0;
#X connect 2 0 4 0;
#X connect 2 1 36 0;
#X connect 3 0 0 2;
#X connect 4 0 0 0;
#X connect 5 0 6 0;
#X connect 6 0 11 0;
#X connect 6 0 12 0;
#X connect 10 0 5 0;
#X connect 13 0 18 0;
#X connect 15 0 16 1;
#X connect 16 0 12 0;
#X connect 16 0 11 0;
#X connect 16 1 1 0;
#X connect 17 0 30 0;
#X connect 18 0 23 0;
#X connect 18 1 24 0;
#X connect 18 2 2 0;
#X connect 18 3 31 0;
#X connect 18 4 19 0;
#X connect 19 0 20 0;
#X connect 22 0 21 0;
#X connect 23 0 22 0;
#X connect 24 0 25 0;
#X connect 24 0 12 0;
#X connect 24 0 11 0;
#X connect 25 0 0 0;
#X connect 28 0 9 0;
#X connect 28 1 8 0;
#X connect 28 2 7 0;
#X connect 28 3 29 0;
#X connect 28 5 27 0;
#X connect 28 6 26 0;
#X connect 31 0 2 0;
#X connect 31 1 30 0;
#X connect 31 2 33 0;
#X connect 32 0 33 0;
#X connect 36 1 28 0;
#X connect 37 0 39 0;
#X connect 38 0 36 1;
#X connect 39 0 38 0;
#X connect 40 0 41 0;
#X connect 41 0 15 0;
