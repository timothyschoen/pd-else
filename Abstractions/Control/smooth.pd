#N canvas 446 146 855 717 12;
#X obj 304 313 line;
#X obj 397 415 b;
#X obj 345 313 r grain_\$0;
#X obj 480 105 v ms_\$0;
#X obj 426 192 v n_\$0;
#X obj 738 354 v target_\$0;
#X obj 304 280 var target_\$0 ms_\$0;
#X obj 679 354 v d_\$0;
#X obj 397 479 expr if(d_\$0 > 0 && $f1 > target_\$0 \, target_\$0 \, $f1);
#X obj 397 506 expr if(d_\$0 < 0 && $f1 < target_\$0 \, target_\$0 \, $f1);
#X obj 606 354 v inc_\$0;
#X obj 546 354 v b_\$0;
#X obj 486 354 v a_\$0;
#X obj 397 447 expr a_\$0 - (b_\$0 = b_\$0 * inc_\$0);
#X obj 387 544 v current_\$0;
#X obj 486 263 expr current_\$0 + b_\$0 \; (target_\$0 - current_\$0) / (1 - exp(curve_\$0)) \; exp(curve_\$0 / n_\$0) \; target_\$0 - current_\$0 \; $f1;
#X obj 426 151 expr ms_\$0/grain_\$0;
#X obj 426 111 t b f;
#X obj 397 600 outlet;
#X obj 123 46 inlet;
#N canvas 814 301 575 545 init 0;
#X obj 153 69 else/loadbanger 2, f 24;
#X msg 372 139 5;
#X msg 338 139 0;
#X msg 409 139 1;
#X obj 72 189 list split 1;
#X obj 72 230 else/swap2;
#X obj 166 189 list split 1;
#X obj 166 230 else/swap2;
#X obj 153 106 else/args -;
#X obj 153 139 route -rate -curve float;
#X obj 372 355 s grain_\$0;
#X obj 338 389 v ms_\$0;
#X obj 409 263 * -4;
#X obj 181 349 v curve_\$0;
#X obj 181 321 v grain_\$0;
#X obj 409 293 s curve_\$0;
#X obj 154 438 v n_\$0;
#X obj 155 397 expr ms_\$0/grain_\$0;
#X obj 88 107 t b b;
#X obj 372 325 max 5;
#X connect 0 0 18 0;
#X connect 0 1 1 0;
#X connect 0 1 2 0;
#X connect 0 1 3 0;
#X connect 1 0 19 0;
#X connect 2 0 11 0;
#X connect 3 0 12 0;
#X connect 4 0 5 0;
#X connect 4 1 5 1;
#X connect 5 0 9 0;
#X connect 5 1 19 0;
#X connect 6 0 7 0;
#X connect 6 1 7 1;
#X connect 7 0 9 0;
#X connect 7 1 12 0;
#X connect 8 0 9 0;
#X connect 9 0 4 0;
#X connect 9 1 6 0;
#X connect 9 2 11 0;
#X connect 12 0 15 0;
#X connect 17 0 16 0;
#X connect 18 0 17 0;
#X connect 18 1 8 0;
#X connect 19 0 10 0;
#X restore 735 152 pd init;
#X obj 378 343 r curve_\$0;
#X obj 378 391 > 0.001;
#X obj 304 415 else/router;
#X obj 426 46 inlet;
#X obj 123 90 route rate reset float list curve;
#X obj 259 131 unpack;
#X obj 322 157 * -4;
#X obj 322 187 s curve_\$0;
#X obj 182 295 v n_\$0;
#X obj 182 254 expr ms_\$0 / (grain_\$0 = $f1), f 16;
#X obj 182 224 max 5;
#X obj 163 341 v target_\$0;
#X msg 244 381 set \$1;
#X text 579 82 Part of ELSE \; https://github.com/porres/pd-else;
#X text 581 63 Alexandre Torres Porres (2025);
#X obj 304 247 t b f, f 7;
#X obj 512 186 r curve_\$0;
#X obj 512 233 > 0.001;
#X obj 412 235 else/router;
#X obj 512 210 abs;
#X obj 378 367 abs;
#X connect 0 0 23 0;
#X connect 1 0 13 0;
#X connect 2 0 0 2;
#X connect 6 0 0 0;
#X connect 8 0 9 0;
#X connect 9 0 14 0;
#X connect 9 0 18 0;
#X connect 13 0 8 0;
#X connect 15 0 12 0;
#X connect 15 1 11 0;
#X connect 15 2 10 0;
#X connect 15 3 7 0;
#X connect 15 4 5 0;
#X connect 16 0 4 0;
#X connect 17 0 16 0;
#X connect 17 1 3 0;
#X connect 19 0 25 0;
#X connect 21 0 41 0;
#X connect 22 0 23 1;
#X connect 23 0 18 0;
#X connect 23 0 14 0;
#X connect 23 1 1 0;
#X connect 24 0 17 0;
#X connect 25 0 31 0;
#X connect 25 1 32 0;
#X connect 25 2 36 0;
#X connect 25 3 26 0;
#X connect 25 4 27 0;
#X connect 26 0 36 0;
#X connect 26 1 17 0;
#X connect 27 0 28 0;
#X connect 30 0 29 0;
#X connect 31 0 30 0;
#X connect 32 0 33 0;
#X connect 32 0 18 0;
#X connect 32 0 14 0;
#X connect 33 0 0 0;
#X connect 36 0 6 0;
#X connect 36 1 39 0;
#X connect 37 0 40 0;
#X connect 38 0 39 1;
#X connect 39 1 15 0;
#X connect 40 0 38 0;
#X connect 41 0 22 0;
